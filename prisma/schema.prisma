generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Team {
  id            String           @id @default(cuid())
  name          String
  code          String           @unique
  displayCode   String
  adminId       String
  plan          Json
  credits       Json
  totalContents Int              @default(0)
  totalBrands   Int              @default(0)
  actions       Action[]
  brands        Brand[]
  joinRequests  JoinRequest[]
  notifications Notification[]
  personas      Persona[]
  themes        StrategicTheme[]
  admin         User             @relation("TeamAdmin", fields: [adminId], references: [id])
  members       User[]           @relation("TeamMembers")
}

model User {
  id                String           @id @default(cuid())
  name              String
  email             String           @unique
  password          String
  phone             String?
  state             String?
  city              String?
  role              UserRole         @default(WITHOUT_TEAM)
  status            UserStatus       @default(NO_TEAM)
  teamId            String?
  resetToken        String?
  resetTokenExpiry  DateTime?
  tutorialCompleted Boolean          @default(false)
  actions           Action[]
  brands            Brand[]
  joinRequests      JoinRequest[]
  notifications     Notification[]
  personas          Persona[]
  themes            StrategicTheme[]
  usageSessions     UsageSession[]
  adminTeams        Team[]           @relation("TeamAdmin")
  team              Team?            @relation("TeamMembers", fields: [teamId], references: [id])
}

model Brand {
  id             String           @id @default(cuid())
  teamId         String
  userId         String
  name           String
  responsible    String
  segment        String
  values         String
  keywords       String
  goals          String
  inspirations   String
  successMetrics String
  references     String
  specialDates   String
  promise        String
  crisisInfo     String
  milestones     String
  collaborations String
  restrictions   String
  moodboard      Json?
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  colorPalette   Json?
  logo           Json?
  referenceImage Json?
  actions        Action[]
  team           Team             @relation(fields: [teamId], references: [id])
  user           User             @relation(fields: [userId], references: [id])
  personas       Persona[]
  themes         StrategicTheme[]
}

model StrategicTheme {
  id             String   @id @default(cuid())
  teamId         String
  userId         String
  brandId        String
  title          String
  description    String
  colorPalette   String
  toneOfVoice    String
  targetAudience String
  hashtags       String
  objectives     String
  contentFormat  String
  macroThemes    String
  bestFormats    String
  platforms      String
  expectedAction String
  additionalInfo String
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  brand          Brand    @relation(fields: [brandId], references: [id])
  team           Team     @relation(fields: [teamId], references: [id])
  user           User     @relation(fields: [userId], references: [id])
}

model Persona {
  id                        String   @id @default(cuid())
  teamId                    String
  userId                    String
  brandId                   String
  name                      String
  gender                    String
  age                       String
  location                  String
  professionalContext       String   @map("role")
  beliefsAndInterests       String   @map("hobbies")
  contentConsumptionRoutine String   @map("consumptionHabits")
  mainGoal                  String   @map("goals")
  challenges                String
  preferredToneOfVoice      String   @default("")
  purchaseJourneyStage      String   @default("")
  interestTriggers          String   @default("")
  createdAt                 DateTime @default(now())
  updatedAt                 DateTime @updatedAt
  brand                     Brand    @relation(fields: [brandId], references: [id])
  team                      Team     @relation(fields: [teamId], references: [id])
  user                      User     @relation(fields: [userId], references: [id])
}

model Action {
  id        String     @id @default(cuid())
  type      ActionType
  brandId   String
  teamId    String
  userId    String
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  details   Json?
  result    Json?
  status    String     @default("Em revisão")
  approved  Boolean    @default(false)
  revisions Int        @default(0)
  brand     Brand      @relation(fields: [brandId], references: [id])
  team      Team       @relation(fields: [teamId], references: [id])
  user      User       @relation(fields: [userId], references: [id])
}

model Notification {
  id        String   @id @default(cuid())
  message   String
  type      String
  userId    String
  teamId    String
  read      Boolean  @default(false)
  createdAt DateTime @default(now())
  team      Team     @relation(fields: [teamId], references: [id])
  user      User     @relation(fields: [userId], references: [id])

  @@index([userId], map: "idx_Notification_userId")
}

model JoinRequest {
  id        String        @id @default(cuid())
  teamId    String
  userId    String
  status    RequestStatus @default(PENDING)
  createdAt DateTime      @default(now())
  team      Team          @relation(fields: [teamId], references: [id])
  user      User          @relation(fields: [userId], references: [id])
}

enum UserRole {
  ADMIN
  MEMBER
  WITHOUT_TEAM
}

enum UserStatus {
  ACTIVE
  PENDING
  INACTIVE
  NO_TEAM
}

enum ActionType {
  CRIAR_CONTEUDO
  REVISAR_CONTEUDO
  PLANEJAR_CONTEUDO
}

enum RequestStatus {
  PENDING
  APPROVED
  REJECTED
}

model UsageSession {
  id        String   @id @default(cuid())
  userId    String
  loginTime DateTime @default(now())
  logoutTime DateTime?
  duration  Int?     // Duração em segundos
  date      DateTime @default(now()) // Data para tracking diário
  active    Boolean  @default(true)   // Se a sessão está ativa
  user      User     @relation(fields: [userId], references: [id])

  @@index([userId], map: "idx_UsageSession_userId")
  @@index([date], map: "idx_UsageSession_date")
}
